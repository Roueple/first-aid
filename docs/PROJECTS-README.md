# Projects Table - Complete Implementation Guide

## üéØ Overview

You now have a complete Projects table system that:
- ‚úÖ Imports from Excel ("Proyek" sheet)
- ‚úÖ Auto-generates 7-digit IDs
- ‚úÖ Calculates finding counts from Findings table
- ‚úÖ Displays with row numbers (unaffected by filters)
- ‚úÖ Provides sorting and filtering
- ‚úÖ Connects to Findings via projectName

## üöÄ Quick Start (3 Steps)

### 1. Install Dependencies
```bash
npm install
```

### 2. Import Your Projects
```bash
npm run import:projects
```

This reads `raw_data.xlsx` ‚Üí "Proyek" sheet and imports to Firestore.

### 3. Add to Your App
```tsx
// In your router or main app
import ProjectsPage from './renderer/pages/ProjectsPage';

// Add route
<Route path="/projects" element={<ProjectsPage />} />
```

## üìÅ What Was Created

### Scripts
- `scripts/import-projects-from-excel.mjs` - Import from Excel
- `scripts/recalculate-project-stats.mjs` - Fix counts

### Components
- `src/components/ProjectsTable.tsx` - Table component
- `src/renderer/pages/ProjectsPage.tsx` - Example page

### Documentation
- `docs/projects-table-setup.md` - Full documentation
- `docs/projects-quick-start.md` - Quick reference
- `PROJECTS-TABLE-COMPLETE.md` - Implementation summary
- `PROJECTS-TABLE-VISUAL-GUIDE.md` - Visual guide

## üìä Excel File Format

Your `raw_data.xlsx` must have a sheet named **"Proyek"** with these columns:

| Column | Required | Notes |
|--------|----------|-------|
| No | No | Ignored (auto-generated on display) |
| SH | Yes | Subholding name |
| Project | Yes | Project name (must be unique) |
| Total Finding | No | Ignored (calculated from Findings) |
| Non-Finding | No | Ignored (calculated from Findings) |
| Type | Yes | Project type |
| Subtype | No | Project subtype |
| Description | No | Project description |

**Important**: The "Total Finding" and "Non-Finding" columns in Excel are **ignored**. Real counts are calculated from your Findings table.

## üî¢ 7-Digit ID Generation

IDs are generated by hashing: `SH-ProjectName-Type`

Example:
```
Input:  SH="SH001", Project="Audit ABC", Type="Internal"
Output: projectId="3847562"
```

Properties:
- Always 7 digits (1000000-9999999)
- Deterministic (same input = same ID)
- Unique per project

## üìã Row Numbers Explained

Row numbers are **display-only** and:
- Not stored in database
- Always sequential (1, 2, 3...)
- **Not affected** by sorting or filtering
- Show current position in view

Example:
```
All Projects (sorted by name):
1. Project A
2. Project B
3. Project C

Filtered (search "B"):
1. Project B  ‚Üê Still shows as #1
```

## üîó Connection to Findings

Projects connect to Findings via `projectName`:

```
Projects                    Findings
‚îú‚îÄ projectName: "ABC"  ‚Üê‚îÄ‚îÄ  projectName: "ABC"
‚îú‚îÄ finding: 5               findingTotal: 12
‚îî‚îÄ nonFinding: 2            findingTotal: 8
                            findingTotal: 0
```

Counts are automatically calculated:
- `finding`: Findings where `findingTotal > 0`
- `nonFinding`: Findings where `findingTotal = 0`

## üõ†Ô∏è Common Tasks

### Import Projects
```bash
npm run import:projects
```

### Recalculate Counts
If counts get out of sync:
```bash
npm run recalc:projects
```

### Query in Code
```typescript
import ProjectService from '../services/ProjectService';

const service = new ProjectService();

// Get all projects
const all = await service.getAllProjects();

// Get by name
const project = await service.getProjectByName('Project ABC');

// Get by subholding
const shProjects = await service.getProjectsBySubholding('SH001');

// Recalculate stats
await service.recalculateProjectStats(projectId);
```

### Use Table Component
```tsx
import ProjectsTable from '../components/ProjectsTable';

<ProjectsTable 
  onProjectSelect={(project) => {
    console.log('Selected:', project);
    // Navigate, show details, etc.
  }}
/>
```

## üé® UI Features

### Sorting
- Click any column header to sort
- Click again to reverse direction
- Arrow indicators show current sort

### Filtering
- Type in search box to filter
- Searches across: Project, SH, Type, Description
- Shows filtered count

### Visual Badges
- Finding count: Red badge
- Non-Finding count: Green badge

### Row Selection
- Hover: Background changes
- Click: Triggers `onProjectSelect` callback

## üîß Troubleshooting

### Import Fails

**Error: Sheet "Proyek" not found**
- Check sheet name is exactly "Proyek" (case-sensitive)
- Verify `raw_data.xlsx` is in project root

**Error: Firebase connection failed**
- Check `.test-credentials.json` exists and is valid
- Verify `.env` has correct Firebase config

**Error: Missing columns**
- Ensure Excel has: SH, Project, Type columns
- Other columns are optional

### Counts Are Wrong

Run recalculation:
```bash
npm run recalc:projects
```

Check:
- Findings have correct `projectName` values
- Project names match exactly (case-sensitive)
- `findingTotal` field exists in Findings

### Table Not Showing

Check browser console for errors:
- Firebase connection issues?
- Projects collection empty?
- Component import path correct?

Verify data exists:
```typescript
const service = new ProjectService();
const projects = await service.getAllProjects();
console.log('Projects:', projects.length);
```

## üì¶ Database Schema

```typescript
interface Project {
  id: string;              // Firestore document ID
  projectId: string;       // 7-digit auto-generated
  sh: string;              // Subholding
  projectName: string;     // Unique, FK for Findings
  projectType: string;     // Project type
  type: string;            // Type classification
  subtype: string;         // Subtype
  description: string;     // Description
  finding: number;         // Count from Findings
  nonFinding: number;      // Count of non-findings
  total: number;           // Total count
  isActive: boolean;       // Active status
  createdAt: Timestamp;    // Creation time
  updatedAt: Timestamp;    // Last update
  createdBy: string;       // Creator
}
```

## üîÑ Automatic Updates

When you create/update/delete a Finding:
1. Finding is saved to Firestore
2. ProjectService automatically recalculates stats
3. Project counts are updated

This ensures counts are always accurate.

## üìù NPM Scripts

```json
{
  "import:projects": "Import projects from Excel",
  "recalc:projects": "Recalculate all project stats"
}
```

## üéØ Next Steps

### Basic Setup
1. ‚úÖ Run `npm install`
2. ‚úÖ Run `npm run import:projects`
3. ‚úÖ Add `<ProjectsPage />` to your router
4. ‚úÖ Test the table

### Optional Enhancements
- Add project details page
- Add edit/delete functionality
- Export projects to Excel
- Add project creation form
- Set up automatic stat recalculation
- Add project status tracking

## üìö Additional Resources

- **Full Documentation**: `docs/projects-table-setup.md`
- **Quick Reference**: `docs/projects-quick-start.md`
- **Visual Guide**: `PROJECTS-TABLE-VISUAL-GUIDE.md`
- **Summary**: `PROJECTS-TABLE-COMPLETE.md`

## ‚úÖ Checklist

Before using:
- [ ] `npm install` completed
- [ ] `raw_data.xlsx` exists with "Proyek" sheet
- [ ] `.test-credentials.json` is valid
- [ ] `.env` has Firebase configuration

To use:
- [ ] Run `npm run import:projects`
- [ ] Verify import succeeded
- [ ] Add `<ProjectsPage />` to router
- [ ] Test sorting and filtering
- [ ] Verify counts are correct

## üÜò Need Help?

1. Check the troubleshooting section above
2. Review the documentation files
3. Check browser console for errors
4. Verify Firebase connection
5. Run recalculation script if counts are off

---

**Everything is ready!** üéâ

Just run `npm run import:projects` and you're good to go!
